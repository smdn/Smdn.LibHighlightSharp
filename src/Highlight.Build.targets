<!--
SPDX-FileCopyrightText: 2022 smdn <smdn@smdn.jp>
SPDX-License-Identifier: MIT
-->
<Project>
  <PropertyGroup>
    <!-- inject the mandatory target for the build on CI -->
    <BuildDependsOn>Highlight_InstallCIBuildDependencies;$(BuildDependsOn)</BuildDependsOn>
  </PropertyGroup>

  <Target
    Name="Highlight_InstallCIBuildDependencies"
    Condition=" '$(GITHUB_ACTIONS)' == 'true' "
  >
    <Exec
      Command="make install-ubuntu.22.04 -f install.mk"
      WorkingDirectory="$(MSBuildThisFileDirectory)..\eng\dependencies\"
      Condition="$([System.Runtime.InteropServices.RuntimeInformation]::RuntimeIdentifier.StartsWith('ubuntu.22.04'))"
    />
  </Target>

  <Target
    Name="Highlight_PrepareHighlightBuildConfigurationsFile"
    Outputs="$(_HighlightBuildConfigurationsFilePath)"
    Condition=" '$(TargetFramework)' != '' "
  >
    <PropertyGroup>
      <_HighlightBuildConfigurationsFilePath>$(BaseIntermediateOutputPath)HighlightConfigurations.g.cs</_HighlightBuildConfigurationsFilePath>
      <_HighlightConfigurationsContent><![CDATA[
// This file was automatically generated by $(MSBuildProjectFile).
// Do not edit this file by hand.
namespace $(Highlight_BindingsNamespace)%3B
internal static class HighlightConfigurations {
  public const string DllImportName = "$(Highlight_BindingsDllImportName)"%3B
  public const string DataDirRelativePath = "$(Highlight_DataDeploymentBasePath)"%3B
}
      ]]></_HighlightConfigurationsContent>
    </PropertyGroup>

    <WriteLinesToFile
      File="$(_HighlightBuildConfigurationsFilePath)"
      Lines="$(_HighlightConfigurationsContent)"
      Overwrite="true"
    />

    <!-- include generated files into the compile target -->
    <ItemGroup>
      <Compile Include="$(_HighlightBuildConfigurationsFilePath)" Visible="false" AutoGen="true" />
    </ItemGroup>
  </Target>
</Project>
